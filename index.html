<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="FenixGroup">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Fenix Group CRM</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --brand: #059669; --brand-light: #ecfdf5;
            --bg: #f8fafc; --card: #ffffff;
            --text: #0f172a; --sub: #64748b;
            --border: #e2e8f0; --safe: #10b981; --warn: #f59e0b;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text);
            margin: 0; padding-top: env(safe-area-inset-top); -webkit-tap-highlight-color: transparent;
        }

        /* LOGO Y HEADER */
        header {
            background: var(--card); padding: 1.2rem 1.5rem; border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50;
        }
        .logo-area { display: flex; align-items: center; gap: 12px; }
        .logo-circle { 
            width: 45px; height: 45px; background: linear-gradient(135deg, var(--brand), #10b981);
            border-radius: 14px; display: flex; align-items: center; justify-content: center;
            color: white; font-weight: 800; font-size: 1.4rem; box-shadow: 0 4px 12px rgba(5, 150, 105, 0.2);
        }

        /* DASHBOARD */
        .dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 1.5rem; }
        .kpi { background: var(--card); padding: 14px 8px; border-radius: 20px; border: 1px solid var(--border); text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .kpi span { display: block; font-size: 0.65rem; font-weight: 700; color: var(--sub); text-transform: uppercase; margin-bottom: 4px; }
        .kpi b { font-size: 1.1rem; font-weight: 800; color: var(--brand); }

        .container { padding: 0 1.5rem 100px; }
        .search-bar { width: 100%; padding: 16px; border-radius: 18px; border: 1.5px solid var(--border); font-size: 1rem; margin-bottom: 20px; box-sizing: border-box; outline: none; transition: 0.3s; }
        .search-bar:focus { border-color: var(--brand); box-shadow: 0 0 0 4px var(--brand-light); }

        /* LISTA DE ANIMALES */
        .animal-card { 
            background: var(--card); border-radius: 24px; padding: 18px; margin-bottom: 14px;
            border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;
            transition: 0.2s;
        }
        .animal-card:active { transform: scale(0.97); background: var(--brand-light); }
        .info h3 { margin: 0; font-size: 1.1rem; font-weight: 800; }
        .info p { margin: 4px 0 0; font-size: 0.8rem; color: var(--sub); font-weight: 600; }
        
        .weight-tag { text-align: right; }
        .weight-tag .main-w { display: block; font-weight: 800; font-size: 1.1rem; color: var(--text); }
        .weight-tag .net-w { font-size: 0.7rem; color: var(--brand); font-weight: 700; }

        /* MODALES */
        .modal { display: none; position: fixed; inset: 0; background: var(--card); z-index: 100; padding: calc(2.5rem + env(safe-area-inset-top)) 1.5rem; overflow-y: auto; }
        .form-group { margin-bottom: 18px; }
        label { display: block; font-size: 0.75rem; font-weight: 800; color: var(--sub); margin-bottom: 8px; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 16px; border-radius: 16px; border: 1.5px solid var(--border); font-size: 1rem; box-sizing: border-box; background: #f1f5f9; font-family: inherit; }
        
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .btn { padding: 18px; border-radius: 18px; border: none; font-weight: 800; font-size: 1rem; cursor: pointer; }
        .btn-primary { background: var(--brand); color: white; }
        .btn-secondary { background: #f1f5f9; color: var(--text); }
        .btn-danger { background: #fee2e2; color: #dc2626; margin-top: 10px; width: 100%; }

        .fab { position: fixed; bottom: calc(30px + env(safe-area-inset-bottom)); right: 20px; width: 68px; height: 68px; background: var(--brand); color: white; border-radius: 22px; border: none; font-size: 32px; box-shadow: 0 12px 24px rgba(5,150,105,0.3); z-index: 80; }
    </style>
</head>
<body>

<header>
    <div class="logo-area">
        <div class="logo-circle">F</div>
        <div>
            <div style="font-weight: 800; font-size: 1.1rem; letter-spacing: -0.5px;">Fenix Group üî•</div>
            <div id="status" style="font-size: 0.65rem; color: var(--brand); font-weight: 800;">PRO DASHBOARD</div>
        </div>
    </div>
    <div id="clock" style="font-weight: 700; font-size: 0.85rem;">00:00</div>
</header>

<div class="dashboard">
    <div class="kpi"><span>Animales</span><b id="k-total">0</b></div>
    <div class="kpi"><span>Media Kg</span><b id="k-avg">0</b></div>
    <div class="kpi"><span>Peso Neto</span><b id="k-net">0</b></div>
</div>

<div class="container">
    <input type="text" id="search" class="search-bar" placeholder="Buscar por ID de animal..." onkeyup="render()">
    <div id="main-list"></div>
</div>

<button class="fab" onclick="showAdd()">+</button>

<div id="modal-form" class="modal">
    <h2 id="modal-title" style="margin-top:0; font-size: 1.8rem; font-weight: 800;">Registro</h2>
    <input type="hidden" id="edit-index">
    
    <div class="form-group">
        <label>ID del Cerdo</label>
        <input type="text" id="f-id" placeholder="Ej: Lote-01">
    </div>
    
    <div class="form-group">
        <label>Peso Bruto (Kg)</label>
        <input type="number" id="f-weight" placeholder="0.00">
    </div>

    <div class="form-group">
        <label>Notas / Observaciones</label>
        <textarea id="f-notes" rows="3" placeholder="Ej: Vacunado, dieta especial..."></textarea>
    </div>

    <div class="btn-group">
        <button class="btn btn-secondary" onclick="closeModals()">Cancelar</button>
        <button class="btn btn-primary" onclick="processSave()">Guardar</button>
    </div>
    <button id="del-btn" class="btn btn-danger" style="display:none;" onclick="processDelete()">Eliminar Animal</button>
</div>

<script>
    let animals = JSON.parse(localStorage.getItem('fenix_v3_data')) || [];

    function showAdd() {
        document.getElementById('modal-title').innerText = "Nuevo Registro";
        document.getElementById('edit-index').value = "-1";
        document.getElementById('f-id').value = "";
        document.getElementById('f-weight').value = "";
        document.getElementById('f-notes').value = "";
        document.getElementById('del-btn').style.display = "none";
        document.getElementById('modal-form').style.display = "block";
    }

    function showEdit(index) {
        const a = animals[index];
        document.getElementById('modal-title').innerText = "Editar Animal";
        document.getElementById('edit-index').value = index;
        document.getElementById('f-id').value = a.id;
        document.getElementById('f-weight').value = a.weight;
        document.getElementById('f-notes').value = a.notes || "";
        document.getElementById('del-btn').style.display = "block";
        document.getElementById('modal-form').style.display = "block";
    }

    function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }

    function processSave() {
        const id = document.getElementById('f-id').value;
        const weight = parseFloat(document.getElementById('f-weight').value);
        const notes = document.getElementById('f-notes').value;
        const idx = parseInt(document.getElementById('edit-index').value);

        if(!id || isNaN(weight)) return alert("Completa ID y Peso");

        const net = (weight * 0.97).toFixed(1); // Merma del 3%
        const date = new Date().toLocaleString([], {day:'2-digit', month:'2-digit', hour:'2-digit', minute:'2-digit'});

        if(idx === -1) {
            animals.unshift({ id, weight, net, notes, date });
        } else {
            animals[idx] = { ...animals[idx], id, weight, net, notes, lastUpdate: date };
        }

        saveAndRender();
        closeModals();
    }

    function processDelete() {
        if(confirm("¬øEliminar este animal permanentemente?")) {
            animals.splice(parseInt(document.getElementById('edit-index').value), 1);
            saveAndRender();
            closeModals();
        }
    }

    function saveAndRender() {
        localStorage.setItem('fenix_v3_data', JSON.stringify(animals));
        render();
    }

    function render() {
        const q = document.getElementById('search').value.toLowerCase();
        const list = document.getElementById('main-list');
        const filtered = animals.filter(a => a.id.toLowerCase().includes(q));

        list.innerHTML = filtered.map((a, i) => `
            <div class="animal-card" onclick="showEdit(${animals.indexOf(a)})">
                <div class="info">
                    <h3>${a.id}</h3>
                    <p>üïí ${a.lastUpdate || a.date}</p>
                    <div style="font-size:0.65rem; color:var(--brand); margin-top:5px; font-weight:800;">${a.notes ? 'üìù CON NOTAS' : 'SIN OBSERVACIONES'}</div>
                </div>
                <div class="weight-tag">
                    <span class="main-w">${a.weight} kg</span>
                    <span class="net-w">Neto: ${a.net} kg</span>
                </div>
            </div>
        `).join('');

        // KPIs
        document.getElementById('k-total').innerText = animals.length;
        const avg = animals.length ? (animals.reduce((acc, a) => acc + a.weight, 0) / animals.length).toFixed(1) : 0;
        const totalNet = animals.reduce((acc, a) => acc + parseFloat(a.net), 0).toFixed(0);
        document.getElementById('k-avg').innerText = avg + "k";
        document.getElementById('k-net').innerText = totalNet + "k";
    }

    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }, 1000);

    window.onload = render;
</script>
</body>
</html>
